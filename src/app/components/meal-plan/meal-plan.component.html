<div class="container mt-2">

  <!-- TABS -->
  <div class="mb-3">
    <ul class="nav nav-tabs d-flex flex-nowrap w-100">
      <li *ngFor="let index of dayIndexes" (click)="setDate(index)" class="nav-item flex-fill text-center mx-0 px-0">
        <a class="nav-link mx-0 px-0" [ngClass]="{ 'active': selectedDay === getDayNameByIndex(index , 'en-US') }" aria-current="page">
          {{ getDayNameByIndex(index , 'pt-BR').slice(0, 3) }}
        </a>
      </li>
    </ul>
  </div>

  <!-- BOTOES -->
  <div class="row g-2 mb-2">
    <div class="col-6 col-md-6">
      <div class="dropdown">
        <button class="w-100 btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          Criar Refeição
        </button>
        <ul class="dropdown-menu w-100">
          <li *ngFor="let meal of predefinedMeals">
            <a class="dropdown-item" (click)="createMeal(meal)">
              Criar {{ meal.name }}
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div class="col-6 col-md-6">
      <button class="w-100 btn btn-outline-primary" (click)="copyModal.open()">
        Copiar para ...
      </button>
    </div>
  </div>

  <!-- BARRAS DE NUTRIÇÂO -->
  <ng-container *ngIf="getSelectedDayPlan() as selectedDay">
    <ng-container *ngIf="calculateDayNutrition(selectedDay) as total">
      <div *ngIf="profileData" class="mb-2">
        <div class="row">

          <div class="col-6 col-md-6">
              <app-progress-bar-card label="Calorias" [current]="total.calories" [goal]="profileData.calorieGoal" unit="kcal" decimalDigits="1.0-0"></app-progress-bar-card>
          </div>

          <div class="col-6 col-md-6">
            <app-progress-bar-card label="Proteína" [current]="total.protein" [goal]="profileData.proteinGoal" unit="g"></app-progress-bar-card>
          </div>

          <div class="col-6 col-md-6">
            <app-progress-bar-card label="Carboidratos" [current]="total.carbs" [goal]="profileData.carbGoal" unit="g"></app-progress-bar-card>
          </div>

          <div class="col-6 col-md-6">
            <app-progress-bar-card label="Gorduras" [current]="total.fat" [goal]="profileData.fatGoal" unit="g"></app-progress-bar-card>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="getSelectedDayPlan().meals.length == 0">
        <div class="alert alert-warning d-flex justify-content-between align-items-center" role="alert">
          <div>
            <i class="fas fa-dumbbell me-2"></i>
            Você não tem refeições cadastradas no plano de hoje. Crie uma nos botões acima.
          </div>
        </div>
    </ng-container>
  </ng-container>

  <!-- LISTA DE REFEIÇÔES -->
  <ul class="list-group">
    <li *ngFor="let meal of getSelectedDayPlan().meals; let i = index" class="list-group-item px-2 px-sm-3">
      <meal-edit
        [meal]="meal"
        [mealIndex]="i"
        [profileData]="profileData"
        [foodList]="importedFoods"
        [showRecordBtn]="true"
        (addMealToExecution)="copyMealToRecord(meal)"
        (deleteMeal)="deleteMeal($event)"
        (mealChanged)="mealChanged(i,$event)"
      ></meal-edit>
    </li>
  </ul>
</div>
<!-- MODAL DE COPIA DE PLANOS -->
<app-modal #copyPlanModal title="Copiar">
  <div class="row">
    <div class="col-12">
      <label class="form-label">Copiar planejamento do dia para:</label>
    </div>
  </div>

  <div class="row">
    <div *ngFor="let index of dayIndexes" class="col-3">
      <div class="form-check" >
        <input class="form-check-input" type="checkbox" [id]="getDayNameByIndex(index , 'en-US')" [(ngModel)]="diasSelecionados[getDayNameByIndex(index , 'en-US')]">
        <label class="form-check-label" [for]="getDayNameByIndex(index , 'en-US')">{{ getDayNameByIndex(index , 'pt-BR').slice(0, 3) }}</label>
      </div>
    </div>
  </div>

  <div modalFooter #modalFooter class="d-flex justify-content-end w-100">
    <!-- Botão à esquerda -->
    <!-- <div>
      <button class="btn btn-outline-danger" (click)="deleteEditingFood()"><i class="fas fa-trash me-1"></i>Excluir</button>
    </div> -->
    <!-- Botões à direita -->
    <div>
      <button class="btn btn-primary me-2" (click)="copiarPlanoParaDias()">Salvar</button>
      <button class="btn btn-outline-secondary" (click)="copyModal.close()">Cancelar</button>
    </div>
  </div>
</app-modal>

